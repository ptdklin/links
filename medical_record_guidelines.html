<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Чек-лист проверки медицинской карты</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Segoe UI', sans-serif; line-height: 1.3; color: #333; background: #667eea; min-height: 100vh; padding: 8px; }
        .container { max-width: 1200px; margin: 0 auto; background: white; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); overflow: hidden; }
        header { background: #2c3e50; color: white; padding: 15px 20px; text-align: center; position: relative; }
        h1 { font-size: 1.6rem; margin-bottom: 4px; font-weight: 600; }
        .subtitle { font-size: 0.9rem; opacity: 0.9; }
        .clear-btn-top { position: absolute; top: 12px; right: 12px; padding: 5px 10px; background: #e74c3c; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.8rem; font-weight: 600; }
        .clear-btn-top:hover { background: #c0392b; }
        .content { padding: 12px 15px; }
        .patient-info { background: #f8f9fa; border-radius: 6px; padding: 12px 15px; margin: 12px 0; border: 1px solid #e9ecef; }
        .info-row { display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 8px; }
        .info-field { flex: 1; min-width: 200px; }
        .info-field label { display: block; font-size: 0.85rem; font-weight: 600; color: #2c3e50; margin-bottom: 4px; }
        .info-field label .optional { font-weight: normal; color: #666; font-size: 0.75rem; }
        .info-field input { width: 100%; padding: 6px 8px; border: 1px solid #e0e0e0; border-radius: 4px; font-size: 0.9rem; font-family: inherit; }
        .info-field input:focus { outline: none; border-color: #3498db; }
        .check-date { text-align: center; font-weight: 600; color: #2c3e50; margin: 8px 0; padding: 6px; background: #e8f4fd; border-radius: 4px; border: 1px solid #3498db; }
        .status { margin: 8px 0; padding: 8px; text-align: center; font-weight: 600; background: #e8f4fd; border-radius: 4px; border: 1px solid #3498db; color: #2c3e50; font-size: 0.85rem; }
        .progress { margin: 8px 0; background: #f8f9fa; border-radius: 4px; padding: 10px; text-align: center; }
        .progress-bar { height: 5px; background: #e9ecef; border-radius: 2px; overflow: hidden; margin: 4px 0; }
        .progress-fill { height: 100%; background: #27ae60; transition: width 0.3s ease; }
        .progress-text { font-weight: 600; color: #2c3e50; font-size: 0.85rem; }
        h2 { font-size: 1.2rem; margin: 15px 0 8px; padding: 8px 12px; background: #f8f9fa; border-left: 3px solid #3498db; border-radius: 4px; color: #2c3e50; }
        .section { margin-bottom: 10px; }
        .question-block { margin-bottom: 4px; padding: 8px 10px; border-radius: 4px; transition: background-color 0.2s ease; border-left: 2px solid transparent; cursor: pointer; }
        .question-block.checked { background-color: #f0f9f0; border-left-color: #27ae60; }
        .question-block:hover { background-color: #f8f9fa; }
        .question-header { display: flex; align-items: flex-start; margin-bottom: 4px; }
        input[type="checkbox"] { margin-right: 8px; margin-top: 2px; transform: scale(1.1); cursor: pointer; pointer-events: none; }
        .question-label { flex: 1; font-size: 1.05rem; cursor: pointer; font-weight: 500; line-height: 1.3; pointer-events: none; }
        .comment-area { width: 100%; padding: 5px 6px; border: 1px solid #e0e0e0; border-radius: 3px; font-size: 0.85rem; font-family: inherit; resize: vertical; min-height: 35px; }
        .comment-area:focus { outline: none; border-color: #3498db; }
        .comment-label { display: block; margin: 4px 0 2px; font-size: 0.8rem; color: #666; font-weight: 500; pointer-events: none; }
        .section-comment { margin: 10px 0; padding: 8px; background: #f8f9fa; border-radius: 4px; border-left: 3px solid #3498db; }
        .section-comment-label { display: block; font-size: 0.75rem; color: #666; font-weight: 600; margin-bottom: 4px; }
        .section-comment-area { width: 100%; padding: 6px 8px; border: 1px solid #e0e0e0; border-radius: 3px; font-size: 0.8rem; font-family: inherit; resize: vertical; min-height: 40px; }
        .bottom-controls { text-align: center; margin-top: 15px; padding: 12px; }
        .save-excel-btn { padding: 8px 20px; background: #27ae60; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.9rem; font-weight: 600; }
        .save-excel-btn:hover { background: #219955; }
        @media (max-width: 768px) {
            body { padding: 5px; }
            .container { border-radius: 6px; }
            header { padding: 12px; }
            h1 { font-size: 1.4rem; }
            .clear-btn-top { position: static; margin-top: 6px; width: 100%; }
            .content { padding: 10px; }
            .question-block { padding: 6px 8px; }
            h2 { font-size: 1.1rem; padding: 6px 10px; margin: 12px 0 6px; }
            .question-label { font-size: 1rem; }
            .save-excel-btn { width: 100%; padding: 10px; }
            .info-field { min-width: 100%; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Чек-лист проверки медицинской карты</h1>
            <p class="subtitle">Форма № 025/у - амбулаторное ведение пациента</p>
            <button type="button" class="clear-btn-top" id="clearBtn">Очистить форму</button>
        </header>

        <div class="content">
            <div class="patient-info">
                <div class="info-row">
                    <div class="info-field">
                        <label>ФИО пациента <span class="optional">(необязательно)</span></label>
                        <input type="text" id="patientName" placeholder="Введите ФИО пациента">
                    </div>
                    <div class="info-field">
                        <label>Дата рождения пациента <span class="optional">(необязательно)</span></label>
                        <input type="date" id="patientBirthDate">
                    </div>
                </div>
                <div class="info-row">
                    <div class="info-field">
                        <label>ID/номер карты <span class="optional">(необязательно)</span></label>
                        <input type="text" id="patientId" placeholder="Номер карты или ID">
                    </div>
                    <div class="info-field">
                        <label>Дата проверки</label>
                        <input type="date" id="checkDate">
                    </div>
                </div>
            </div>

            <div class="check-date" id="currentDateDisplay"></div>

            <div class="status" id="statusMessage">Готов к работе • Автосохранение каждые 10 секунд</div>
            
            <div class="progress">
                <div class="progress-text">Прогресс проверки: <span id="progressPercent">0%</span></div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                </div>
                <div>Проверено: <span id="completedCount">0</span> из <span id="totalCount">0</span> пунктов</div>
            </div>

            <form id="checklistForm">
                <!-- Раздел 1 -->
                <div class="section">
                    <h2>Раздел 1: Оформление титульного листа и паспортных данных</h2>
                    
                    <div class="question-block" data-id="1.1">
                        <div class="question-header">
                            <input type="checkbox" id="1.1" name="1.1">
                            <label for="1.1" class="question-label">
                                <strong>1.1.</strong> В левом верхнем углу указаны название и адрес медицинской организации.
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_1.1" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="1.2">
                        <div class="question-header">
                            <input type="checkbox" id="1.2" name="1.2">
                            <label for="1.2" class="question-label">
                                <strong>1.2.</strong> Полностью (без сокращений) указаны ФИО, дата рождения пациента.
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_1.2" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="1.3">
                        <div class="question-header">
                            <input type="checkbox" id="1.3" name="1.3">
                            <label for="1.3" class="question-label">
                                <strong>1.3.</strong> В п.5 указаны адреса: постоянной и временной регистрации, фактический.
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_1.3" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="1.4">
                        <div class="question-header">
                            <input type="checkbox" id="1.4" name="1.4">
                            <label for="1.4" class="question-label">
                                <strong>1.4.</strong> Полис ОМС (номер, серия, дата выдачи, страховая компания).
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_1.4" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="1.5">
                        <div class="question-header">
                            <input type="checkbox" id="1.5" name="1.5">
                            <label for="1.5" class="question-label">
                                <strong>1.5.</strong> СНИЛС.
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_1.5" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="1.6">
                        <div class="question-header">
                            <input type="checkbox" id="1.6" name="1.6">
                            <label for="1.6" class="question-label">
                                <strong>1.6.</strong> Документ, удостоверяющий личность (сведения о дате и органе выдачи).
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_1.6" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="1.7">
                        <div class="question-header">
                            <input type="checkbox" id="1.7" name="1.7">
                            <label for="1.7" class="question-label">
                                <strong>1.7.</strong> В правом верхнем углу указаны № участка и № ФРБТ.
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_1.7" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="1.8">
                        <div class="question-header">
                            <input type="checkbox" id="1.8" name="1.8">
                            <label for="1.8" class="question-label">
                                <strong>1.8.</strong> В п.6 указан контактный телефон пациента и/или доверенного лица.
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_1.8" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="1.9">
                        <div class="question-header">
                            <input type="checkbox" id="1.9" name="1.9">
                            <label for="1.9" class="question-label">
                                <strong>1.9.</strong> Копии документов приобщаются к карте ТОЛЬКО с письменного согласия пациента. На копиях делается отметка о согласии.
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_1.9" placeholder="Введите комментарий..."></textarea>
                    </div>

                    <div class="section-comment">
                        <label class="section-comment-label">Общий комментарий к разделу 1:</label>
                        <textarea class="section-comment-area" id="section_comment_1" placeholder="Введите общий комментарий к разделу..."></textarea>
                    </div>
                </div>

                <!-- Раздел 2 -->
                <div class="section">
                    <h2>Раздел 2: Диагноз, информированные согласия, извещения</h2>
                    
                    <div class="question-block" data-id="2.1">
                        <div class="question-header">
                            <input type="checkbox" id="2.1" name="2.1">
                            <label for="2.1" class="question-label">
                                <strong>2.1.</strong> В  ф. 025/у указан клинический диагноз и коды по МКБ.
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_2.1" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="2.2">
                        <div class="question-header">
                            <input type="checkbox" id="2.2" name="2.2">
                            <label for="2.2" class="question-label">
                                <strong>2.2.</strong> На оборотной стороне внесены данные об аллергических и нежелательных реакциях (либо прописано в любом месте на оборотной стороны обложки).
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_2.2" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="2.3">
                        <div class="question-header">
                            <input type="checkbox" id="2.3" name="2.3">
                            <label for="2.3" class="question-label">
                                <strong>2.3.</strong> Приложен корешок извещения об установлении/прекращении диспансерного наблюдения (форма соответствует утвержденной).
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_2.3" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="2.4">
                        <div class="question-header">
                            <input type="checkbox" id="2.4" name="2.4">
                            <label for="2.4" class="question-label">
                                <strong>2.4.</strong> Приложено информированное добровольное согласие (ИДС) на мед. вмешательство (форма по Приказу №1051н).
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_2.4" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="2.5">
                        <div class="question-header">
                            <input type="checkbox" id="2.5" name="2.5">
                            <label for="2.5" class="question-label">
                                <strong>2.5.</strong> Заполнено, подписано пациентом/представителем и медработником с расшифровкой ФИО.
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_2.5" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="2.6">
                        <div class="question-header">
                            <input type="checkbox" id="2.6" name="2.6">
                            <label for="2.6" class="question-label">
                                <strong>2.6.</strong> В случае отказа -- сделана запись о разъяснении последствий с указанием ФИО и должности специалиста.
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_2.6" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="2.7">
                        <div class="question-header">
                            <input type="checkbox" id="2.7" name="2.7">
                            <label for="2.7" class="question-label">
                                <strong>2.7.</strong> Приложено ИДС на обработку персональных данных (форма по Распоряжению №144-Р).
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_2.7" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="2.8">
                        <div class="question-header">
                            <input type="checkbox" id="2.8" name="2.8">
                            <label for="2.8" class="question-label">
                                <strong>2.8.</strong> Заполнено, подписано пациентом/представителем и медработником с расшифровкой ФИО.
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_2.8" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="2.9">
                        <div class="question-header">
                            <input type="checkbox" id="2.9" name="2.9">
                            <label for="2.9" class="question-label">
                                <strong>2.9.</strong> Строка о предоставлении сведений о состоянии здоровья другому лицу заполнена.
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_2.9" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="2.10">
                        <div class="question-header">
                            <input type="checkbox" id="2.10" name="2.10">
                            <label for="2.10" class="question-label">
                                <strong>2.10.</strong> Приложено согласие на пробу с Диаскинтестом (форма по Приказу №89/25).
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_2.10" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="2.11">
                        <div class="question-header">
                            <input type="checkbox" id="2.11" name="2.11">
                            <label for="2.11" class="question-label">
                                <strong>2.11.</strong> Проверить четкость печати в бланках согласий, отсутствие обрезки текста.
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_2.11" placeholder="Введите комментарий..."></textarea>
                    </div>

                    <div class="section-comment">
                        <label class="section-comment-label">Общий комментарий к разделу 2:</label>
                        <textarea class="section-comment-area" id="section_comment_2" placeholder="Введите общий комментарий к разделу..."></textarea>
                    </div>
                </div>

                <!-- Раздел 3 -->
                <div class="section">
                    <h2>Раздел 3: Полнота записей в типовых шаблонах (анамнез, осмотр)</h2>
                    
                    <div class="question-block" data-id="3.1">
                        <div class="question-header">
                            <input type="checkbox" id="3.1" name="3.1">
                            <label for="3.1" class="question-label">
                                <strong>3.1.</strong> Указаны жалобы пациента.
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_3.1" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="3.2">
                        <div class="question-header">
                            <input type="checkbox" id="3.2" name="3.2">
                            <label for="3.2" class="question-label">
                                <strong>3.2.</strong> Указано направление на консультацию или «самообращение».
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_3.2" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="3.3">
                        <div class="question-header">
                            <input type="checkbox" id="3.3" name="3.3">
                            <label for="3.3" class="question-label">
                                <strong>3.3.</strong> Эпидемиологический анамнез (контакты, перенесенный туберкулез).
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_3.3" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="3.4">
                        <div class="question-header">
                            <input type="checkbox" id="3.4" name="3.4">
                            <label for="3.4" class="question-label">
                                <strong>3.4.</strong> Сведения о детях в очаге, семейных и производственных контактах.
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_3.4" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="3.5">
                        <div class="question-header">
                            <input type="checkbox" id="3.5" name="3.5">
                            <label for="3.5" class="question-label">
                                <strong>3.5.</strong> Сопутствующие заболевания, вредные привычки, пребывание в ФСИН.
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_3.5" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="3.6">
                        <div class="question-header">
                            <input type="checkbox" id="3.6" name="3.6">
                            <label for="3.6" class="question-label">
                                <strong>3.6.</strong> Указаны сведения о направляющем специалисте, дате и обстоятельствах выявления патологии.
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_3.6" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="3.7">
                        <div class="question-header">
                            <input type="checkbox" id="3.7" name="3.7">
                            <label for="3.7" class="question-label">
                                <strong>3.7.</strong> Заполнен клинико-экспертный анамнез (даже для неработающих).
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_3.7" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="3.8">
                        <div class="question-header">
                            <input type="checkbox" id="3.8" name="3.8">
                            <label for="3.8" class="question-label">
                                <strong>3.8.</strong> Указаны перенесенные инфекции, переливания крови, поездки за последние 6 месяцев.
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_3.8" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="3.9">
                        <div class="question-header">
                            <input type="checkbox" id="3.9" name="3.9">
                            <label for="3.9" class="question-label">
                                <strong>3.9.</strong> Внесены все результаты: иммунодиагностики, бактериограммы, лабораторных и инструментальных исследований.
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_3.9" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="3.10">
                        <div class="question-header">
                            <input type="checkbox" id="3.10" name="3.10">
                            <label for="3.10" class="question-label">
                                <strong>3.10.</strong> Отражены данные объективного осмотра и оценка тяжести состояния.
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_3.10" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="3.11">
                        <div class="question-header">
                            <input type="checkbox" id="3.11" name="3.11">
                            <label for="3.11" class="question-label">
                                <strong>3.11.</strong> Имеется обоснование предварительного диагноза.
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_3.11" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="3.12">
                        <div class="question-header">
                            <input type="checkbox" id="3.12" name="3.12">
                            <label for="3.12" class="question-label">
                                <strong>3.12.</strong> Указаны сведения о лучевой нагрузке, учтены данные исследований, проведенных в других медицинских организациях, время исследования.
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_3.12" placeholder="Введите комментарий..."></textarea>
                    </div>

                    <div class="section-comment">
                        <label class="section-comment-label">Общий комментарий к разделу 3:</label>
                        <textarea class="section-comment-area" id="section_comment_3" placeholder="Введите общий комментарий к разделу..."></textarea>
                    </div>
                </div>

                <!-- Раздел 4 -->
                <div class="section">
                    <h2>Раздел 4: Оформление диспансерного наблюдения (Эпикриз ВК)</h2>
                    
                    <div class="question-block" data-id="4.1">
                        <div class="question-header">
                            <input type="checkbox" id="4.1" name="4.1">
                            <label for="4.1" class="question-label">
                                <strong>4.1.</strong> Оформлен эпикриз ВК о взятии под диспансерное наблюдение (по установленной форме).
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_4.1" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="4.2">
                        <div class="question-header">
                            <input type="checkbox" id="4.2" name="4.2">
                            <label for="4.2" class="question-label">
                                <strong>4.2.</strong> Диагноз в решении ВК оформлен по клинической классификации (форма, локализация, фаза, МБТ, ЛУ, осложнения).
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_4.2" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="4.3">
                        <div class="question-header">
                            <input type="checkbox" id="4.3" name="4.3">
                            <label for="4.3" class="question-label">
                                <strong>4.3.</strong> Имеется подробное обоснование диагноза.
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_4.3" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="4.4">
                        <div class="question-header">
                            <input type="checkbox" id="4.4" name="4.4">
                            <label for="4.4" class="question-label">
                                <strong>4.4.</strong> Указаны группа диспансерного наблюдения, режим химиотерапии, дата проведения ВК.
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_4.4" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="4.5">
                        <div class="question-header">
                            <input type="checkbox" id="4.5" name="4.5">
                            <label for="4.5" class="question-label">
                                <strong>4.5.</strong> Заключительный диагноз установлен в срок не более 14 дней.
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_4.5" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="4.6">
                        <div class="question-header">
                            <input type="checkbox" id="4.6" name="4.6">
                            <label for="4.6" class="question-label">
                                <strong>4.6.</strong> Дата ВК совпадает с датой подачи извещений (ф. 058/у и 089/у) и диагнозом в листе уточненных диагнозов.
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_4.6" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <!-- ОБЪЕДИНЕННЫЙ ПУНКТ 4.7-4.8 -->
                    <div class="question-block" data-id="4.7">
                        <div class="question-header">
                            <input type="checkbox" id="4.7" name="4.7">
                            <label for="4.7" class="question-label">
                                <strong>4.7.</strong> В протоколе ВК отражена схема лечения или имеется запись о том, что схема лечения будет разработана в стационаре.
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_4.7" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="4.9">
                        <div class="question-header">
                            <input type="checkbox" id="4.9" name="4.9">
                            <label for="4.9" class="question-label">
                                <strong>4.9.</strong> В протоколе ВК отражен план ведения (консультация специалистов, лабораторные и инструментальные методы исследования).
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_4.9" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="4.10">
                        <div class="question-header">
                            <input type="checkbox" id="4.10" name="4.10">
                            <label for="4.10" class="question-label">
                                <strong>4.10.</strong> Оформлен протокол ВК о постановке на бациллярный учет.
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_4.10" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="4.11">
                        <div class="question-header">
                            <input type="checkbox" id="4.11" name="4.11">
                            <label for="4.11" class="question-label">
                                <strong>4.11.</strong> Подана повторно форма 058/у.
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_4.11" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="4.12">
                        <div class="question-header">
                            <input type="checkbox" id="4.12" name="4.12">
                            <label for="4.12" class="question-label">
                                <strong>4.12.</strong> Внесены изменения в журнал (ф. № 60-у) и лист уточненных диагнозов.
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_4.12" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="4.13">
                        <div class="question-header">
                            <input type="checkbox" id="4.13" name="4.13">
                            <label for="4.13" class="question-label">
                                <strong>4.13.</strong> Указана дата госпитализации. Ведутся ежемесячные записи о лечении в стационаре.
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_4.13" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="4.14">
                        <div class="question-header">
                            <input type="checkbox" id="4.14" name="4.14">
                            <label for="4.14" class="question-label">
                                <strong>4.14.</strong> Посещение очага туберкулезной инфекции проведено в срок до 3 суток с момента постановки на учет.
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_4.14" placeholder="Введите комментарий..."></textarea>
                    </div>

                    <div class="section-comment">
                        <label class="section-comment-label">Общий комментарий к разделу 4:</label>
                        <textarea class="section-comment-area" id="section_comment_4" placeholder="Введите общий комментарий к разделу..."></textarea>
                    </div>
                </div>

                <!-- Раздел 5 -->
                <div class="section">
                    <h2>Раздел 5: Этапный эпикриз после стационарного лечения</h2>
                    
                    <div class="question-block" data-id="5.1">
                        <div class="question-header">
                            <input type="checkbox" id="5.1" name="5.1">
                            <label for="5.1" class="question-label">
                                <strong>5.1.</strong> Отражены достигнутые результаты на стационарном этапе.
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_5.1" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="5.2">
                        <div class="question-header">
                            <input type="checkbox" id="5.2" name="5.2">
                            <label for="5.2" class="question-label">
                                <strong>5.2.</strong> Имеются рекомендации стационара по дальнейшему ведению лечения.
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_5.2" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="5.3">
                        <div class="question-header">
                            <input type="checkbox" id="5.3" name="5.3">
                            <label for="5.3" class="question-label">
                                <strong>5.3.</strong> При наличии данных о непереносимости лекарственных препаратов эти сведения отражены в этапном эпикризе, а также перенесены на оборотную сторону титульного листа формы 025/у.
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_5.3" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="5.4">
                        <div class="question-header">
                            <input type="checkbox" id="5.4" name="5.4">
                            <label for="5.4" class="question-label">
                                <strong>5.4.</strong> Указаны причины выписки из стационара.
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_5.4" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="5.5">
                        <div class="question-header">
                            <input type="checkbox" id="5.5" name="5.5">
                            <label for="5.5" class="question-label">
                                <strong>5.5.</strong> Отражено, была ли консультация хирурга и ее результаты.
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_5.5" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="5.6">
                        <div class="question-header">
                            <input type="checkbox" id="5.6" name="5.6">
                            <label for="5.6" class="question-label">
                                <strong>5.6.</strong> Составлен подробный план ведения и лечения пациента.
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_5.6" placeholder="Введите комментарий..."></textarea>
                    </div>

                    <div class="section-comment">
                        <label class="section-comment-label">Общий комментарий к разделу 5:</label>
                        <textarea class="section-comment-area" id="section_comment_5" placeholder="Введите общий комментарий к разделу..."></textarea>
                    </div>
                </div>

                <!-- Раздел 6 -->
                <div class="section">
                    <h2>Раздел 6: Ведение дневниковых записей на амбулаторном этапе</h2>
                    
                    <div class="question-block" data-id="6.1">
                        <div class="question-header">
                            <input type="checkbox" id="6.1" name="6.1">
                            <label for="6.1" class="question-label">
                                <strong>6.1.</strong> По окончании каждого этапа своевременно проведено ВК.
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_6.1" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="6.2">
                        <div class="question-header">
                            <input type="checkbox" id="6.2" name="6.2">
                            <label for="6.2" class="question-label">
                                <strong>6.2.</strong> Записи ведутся не реже 1 раза в 7 дней (или чаще по необходимости).
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_6.2" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="6.3">
                        <div class="question-header">
                            <input type="checkbox" id="6.3" name="6.3">
                            <label for="6.3" class="question-label">
                                <strong>6.3.</strong> Указаны жалобы (детализировано).
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_6.3" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="6.4">
                        <div class="question-header">
                            <input type="checkbox" id="6.4" name="6.4">
                            <label for="6.4" class="question-label">
                                <strong>6.4.</strong> Отражена полнота объективного осмотра (АД, ЧСС, ЧДД).
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_6.4" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="6.5">
                        <div class="question-header">
                            <input type="checkbox" id="6.5" name="6.5">
                            <label for="6.5" class="question-label">
                                <strong>6.5.</strong> Отражены результаты и интерпретация предыдущих лабораторных и инструментальных исследований.
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_6.5" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="6.6">
                        <div class="question-header">
                            <input type="checkbox" id="6.6" name="6.6">
                            <label for="6.6" class="question-label">
                                <strong>6.6.</strong> Указано, что пациент ознакомлен с результатами обследования.
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_6.6" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="6.7">
                        <div class="question-header">
                            <input type="checkbox" id="6.7" name="6.7">
                            <label for="6.7" class="question-label">
                                <strong>6.7.</strong> Указан развернутый клинический диагноз (без сокращений).
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_6.7" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="6.8">
                        <div class="question-header">
                            <input type="checkbox" id="6.8" name="6.8">
                            <label for="6.8" class="question-label">
                                <strong>6.8.</strong> Назначены дополнительные методы исследований в соответствии с клиническими рекомендациями.
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_6.8" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="6.9">
                        <div class="question-header">
                            <input type="checkbox" id="6.9" name="6.9">
                            <label for="6.9" class="question-label">
                                <strong>6.9.</strong> Соблюдена кратность направлений к другим специалистам.
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_6.9" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="6.10">
                        <div class="question-header">
                            <input type="checkbox" id="6.10" name="6.10">
                            <label for="6.10" class="question-label">
                                <strong>6.10.</strong> При назначении ЛС указаны: доза, способ введения, кратность, время приема, связь с пищей, количество выданного.
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_6.10" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="6.11">
                        <div class="question-header">
                            <input type="checkbox" id="6.11" name="6.11">
                            <label for="6.11" class="question-label">
                                <strong>6.11.</strong> Указана дата следующей явки.
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_6.11" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="6.12">
                        <div class="question-header">
                            <input type="checkbox" id="6.12" name="6.12">
                            <label for="6.12" class="question-label">
                                <strong>6.12.</strong> Запись подписана лечащим врачом с расшифровкой подписи.
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_6.12" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="6.13">
                        <div class="question-header">
                            <input type="checkbox" id="6.13" name="6.13">
                            <label for="6.13" class="question-label">
                                <strong>6.13.</strong> Записи в карте полностью отражают клиническое мышление врача; обоснованность назначения любых исследований не вызывает вопросов, не требует уточнений.
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_6.13" placeholder="Введите комментарий..."></textarea>
                    </div>

                    <div class="section-comment">
                        <label class="section-comment-label">Общий комментарий к разделу 6:</label>
                        <textarea class="section-comment-area" id="section_comment_6" placeholder="Введите общий комментарий к разделу..."></textarea>
                    </div>
                </div>

                <!-- Раздел 7 -->
                <div class="section">
                    <h2>Раздел 7: Наличие протоколов ВК (обязательные случаи)</h2>
                    
                    <div class="question-block" data-id="7.1">
                        <div class="question-header">
                            <input type="checkbox" id="7.1" name="7.1">
                            <label for="7.1" class="question-label">
                                <strong>7.1.</strong> Взятие/снятие с диспансерного наблюдения.
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_7.1" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="7.2">
                        <div class="question-header">
                            <input type="checkbox" id="7.2" name="7.2">
                            <label for="7.2" class="question-label">
                                <strong>7.2.</strong> Перевод в другую группу диспансерного наблюдения.
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_7.2" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="7.3">
                        <div class="question-header">
                            <input type="checkbox" id="7.3" name="7.3">
                            <label for="7.3" class="question-label">
                                <strong>7.3.</strong> Окончание интенсивной фазы и перевод на фазу продолжения.
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_7.3" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="7.4">
                        <div class="question-header">
                            <input type="checkbox" id="7.4" name="7.4">
                            <label for="7.4" class="question-label">
                                <strong>7.4.</strong> Продление фазы лечения сверх установленного срока.
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_7.4" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="7.5">
                        <div class="question-header">
                            <input type="checkbox" id="7.5" name="7.5">
                            <label for="7.5" class="question-label">
                                <strong>7.5.</strong> Изменение схемы лечения (замена препаратов, НЯ, отсутствие в аптеке).
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_7.5" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="7.6">
                        <div class="question-header">
                            <input type="checkbox" id="7.6" name="7.6">
                            <label for="7.6" class="question-label">
                                <strong>7.6.</strong> Появление полости распада или бактериовыделения (изменение в листе диагнозов).
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_7.6" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="7.7">
                        <div class="question-header">
                            <input type="checkbox" id="7.7" name="7.7">
                            <label for="7.7" class="question-label">
                                <strong>7.7.</strong> Выписка из стационара с назначением дорогостоящих или 5 и более препаратов.
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_7.7" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="7.8">
                        <div class="question-header">
                            <input type="checkbox" id="7.8" name="7.8">
                            <label for="7.8" class="question-label">
                                <strong>7.8.</strong> Назначение профилактического лечения группам риска.
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_7.8" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="7.9">
                        <div class="question-header">
                            <input type="checkbox" id="7.9" name="7.9">
                            <label for="7.9" class="question-label">
                                <strong>7.9.</strong> Направление на МСЭ (оформление ф. 088/у).
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_7.9" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="7.10">
                        <div class="question-header">
                            <input type="checkbox" id="7.10" name="7.10">
                            <label for="7.10" class="question-label">
                                <strong>7.10.</strong> Выдача/продление листка нетрудоспособности свыше 15 дней.
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_7.10" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="7.11">
                        <div class="question-header">
                            <input type="checkbox" id="7.11" name="7.11">
                            <label for="7.11" class="question-label">
                                <strong>7.11.</strong> Допуск к труду/учебе, оформление академического отпуска.
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_7.11" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="7.12">
                        <div class="question-header">
                            <input type="checkbox" id="7.12" name="7.12">
                            <label for="7.12" class="question-label">
                                <strong>7.12.</strong> Разбор жалоб и случаев смерти.
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_7.12" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="7.13">
                        <div class="question-header">
                            <input type="checkbox" id="7.13" name="7.13">
                            <label for="7.13" class="question-label">
                                <strong>7.13.</strong> Подписи не менее 3-х членов ВК с указанием номера и даты.
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_7.13" placeholder="Введите комментарий..."></textarea>
                    </div>

                    <div class="section-comment">
                        <label class="section-comment-label">Общий комментарий к разделу 7:</label>
                        <textarea class="section-comment-area" id="section_comment_7" placeholder="Введите общий комментарий к разделу..."></textarea>
                    </div>
                </div>

                <!-- Раздел 8 -->
                <div class="section">
                    <h2>Раздел 8: Виды эпикризов (должны присутствовать)</h2>
                    
                    <div class="question-block" data-id="8.1">
                        <div class="question-header">
                            <input type="checkbox" id="8.1" name="8.1">
                            <label for="8.1" class="question-label">
                                <strong>8.1.</strong> Эпикриз при продолжении лечения после стационара.
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_8.1" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="8.2">
                        <div class="question-header">
                            <input type="checkbox" id="8.2" name="8.2">
                            <label for="8.2" class="question-label">
                                <strong>8.2.</strong> Этапный эпикриз при переводе из интенсивной фазы в фазу продолжения.
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_8.2" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="8.3">
                        <div class="question-header">
                            <input type="checkbox" id="8.3" name="8.3">
                            <label for="8.3" class="question-label">
                                <strong>8.3.</strong> Годовой эпикриз.
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_8.3" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="8.4">
                        <div class="question-header">
                            <input type="checkbox" id="8.4" name="8.4">
                            <label for="8.4" class="question-label">
                                <strong>8.4.</strong> Эпикриз передачи пациента другому врачу на период отпуска.
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_8.4" placeholder="Введите комментарий..."></textarea>
                    </div>

                    <div class="section-comment">
                        <label class="section-comment-label">Общий комментарий к разделу 8:</label>
                        <textarea class="section-comment-area" id="section_comment_8" placeholder="Введите общий комментарий к разделу..."></textarea>
                    </div>
                </div>

                <!-- Раздел 9 -->
                <div class="section">
                    <h2>Раздел 9: Организация работы в ЕМИАС</h2>
                    
                    <div class="question-block" data-id="9.1">
                        <div class="question-header">
                            <input type="checkbox" id="9.1" name="9.1">
                            <label for="9.1" class="question-label">
                                <strong>9.1.</strong> Сведения о каждом посещении вносятся в ЕМИАС в день визита.
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_9.1" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="9.2">
                        <div class="question-header">
                            <input type="checkbox" id="9.2" name="9.2">
                            <label for="9.2" class="question-label">
                                <strong>9.2.</strong> Каждое посещение вносится как первичное, вид услуги -- «ОМС».
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_9.2" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="9.3">
                        <div class="question-header">
                            <input type="checkbox" id="9.3" name="9.3">
                            <label for="9.3" class="question-label">
                                <strong>9.3.</strong> Дата в ТАП и дата дневниковой записи строго совпадают.
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_9.3" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="9.4">
                        <div class="question-header">
                            <input type="checkbox" id="9.4" name="9.4">
                            <label for="9.4" class="question-label">
                                <strong>9.4.</strong> Клинический диагноз в ТАП и дневниковой записи совпадает.
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_9.4" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="9.5">
                        <div class="question-header">
                            <input type="checkbox" id="9.5" name="9.5">
                            <label for="9.5" class="question-label">
                                <strong>9.5.</strong> В один день не оформляются посещения врача-фтизиатра двух разных филиалов/КДО.
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_9.5" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="9.6">
                        <div class="question-header">
                            <input type="checkbox" id="9.6" name="9.6">
                            <label for="9.6" class="question-label">
                                <strong>9.6.</strong> Расписание приемов в ЕМИАС соответствует фактическому.
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_9.6" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="9.7">
                        <div class="question-header">
                            <input type="checkbox" id="9.7" name="9.7">
                            <label for="9.7" class="question-label">
                                <strong>9.7.</strong> Телемедицинские консультации (видеоконтроль) оформляются как первичное посещение, вид услуги -- «ОМС».
                            </label>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_9.7" placeholder="Введите комментарий..."></textarea>
                    </div>

                    <div class="section-comment">
                        <label class="section-comment-label">Общий комментарий к разделу 9:</label>
                        <textarea class="section-comment-area" id="section_comment_9" placeholder="Введите общий комментарий к разделу..."></textarea>
                    </div>
                </div>
            </form>

            <div class="bottom-controls">
                <button type="button" class="save-excel-btn" id="saveExcelBtn">Сохранить в Excel</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('checklistForm');
            const statusMessage = document.getElementById('statusMessage');
            const clearBtn = document.getElementById('clearBtn');
            const saveExcelBtn = document.getElementById('saveExcelBtn');
            const progressFill = document.getElementById('progressFill');
            const progressPercent = document.getElementById('progressPercent');
            const completedCount = document.getElementById('completedCount');
            const totalCount = document.getElementById('totalCount');
            const currentDateDisplay = document.getElementById('currentDateDisplay');
            
            const patientName = document.getElementById('patientName');
            const patientBirthDate = document.getElementById('patientBirthDate');
            const patientId = document.getElementById('patientId');
            const checkDate = document.getElementById('checkDate');
            
            let autoSaveInterval;
            
            function setCurrentDate() {
                const now = new Date();
                const today = now.toISOString().split('T')[0];
                const formattedDate = now.toLocaleDateString('ru-RU', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric'
                });
                
                checkDate.value = today;
                currentDateDisplay.textContent = `Дата проверки: ${formattedDate}`;
            }
            
            function initCounters() {
                const checkboxes = form.querySelectorAll('input[type="checkbox"]');
                totalCount.textContent = checkboxes.length;
                updateProgress();
            }
            
            function updateProgress() {
                const checkboxes = form.querySelectorAll('input[type="checkbox"]');
                const checked = form.querySelectorAll('input[type="checkbox"]:checked');
                const percent = Math.round((checked.length / checkboxes.length) * 100);
                
                progressFill.style.width = percent + '%';
                progressPercent.textContent = percent + '%';
                completedCount.textContent = checked.length;
                
                checkboxes.forEach(checkbox => {
                    const block = checkbox.closest('.question-block');
                    if (checkbox.checked) {
                        block.classList.add('checked');
                    } else {
                        block.classList.remove('checked');
                    }
                });
            }
            
            function setupCommentAutoCheck() {
                const commentAreas = form.querySelectorAll('.comment-area');
                commentAreas.forEach(area => {
                    area.addEventListener('input', function() {
                        if (this.value.trim() !== '') {
                            const questionId = this.id.replace('comment_', '');
                            const checkbox = document.getElementById(questionId);
                            if (checkbox && !checkbox.checked) {
                                checkbox.checked = true;
                                updateProgress();
                            }
                        }
                    });
                });
            }
            
            function setupBlockClick() {
                const questionBlocks = document.querySelectorAll('.question-block');
                questionBlocks.forEach(block => {
                    block.addEventListener('click', function(e) {
                        if (e.target.tagName === 'TEXTAREA') return;
                        
                        const checkbox = this.querySelector('input[type="checkbox"]');
                        if (checkbox) {
                            checkbox.checked = !checkbox.checked;
                            updateProgress();
                            saveData();
                        }
                    });
                });
            }
            
            function loadSavedData() {
                const savedData = localStorage.getItem('checklistData');
                const savedComments = localStorage.getItem('checklistComments');
                const savedPatientInfo = localStorage.getItem('patientInfo');
                const savedSectionComments = localStorage.getItem('sectionComments');
                
                if (savedData) {
                    const data = JSON.parse(savedData);
                    for (const key in data) {
                        const checkbox = document.getElementById(key);
                        if (checkbox) {
                            checkbox.checked = data[key];
                        }
                    }
                }
                
                if (savedComments) {
                    const comments = JSON.parse(savedComments);
                    for (const key in comments) {
                        const commentArea = document.getElementById('comment_' + key);
                        if (commentArea) {
                            commentArea.value = comments[key];
                        }
                    }
                }
                
                if (savedSectionComments) {
                    const sectionComments = JSON.parse(savedSectionComments);
                    for (const key in sectionComments) {
                        const sectionCommentArea = document.getElementById('section_comment_' + key);
                        if (sectionCommentArea) {
                            sectionCommentArea.value = sectionComments[key];
                        }
                    }
                }
                
                if (savedPatientInfo) {
                    const patientInfo = JSON.parse(savedPatientInfo);
                    patientName.value = patientInfo.name || '';
                    patientBirthDate.value = patientInfo.birthDate || '';
                    patientId.value = patientInfo.id || '';
                    if (patientInfo.checkDate) {
                        checkDate.value = patientInfo.checkDate;
                        const date = new Date(patientInfo.checkDate);
                        currentDateDisplay.textContent = `Дата проверки: ${date.toLocaleDateString('ru-RU')}`;
                    }
                }
                
                updateProgress();
                showStatus('Данные загружены', 'success');
            }
            
            function saveData() {
                const data = {};
                const comments = {};
                const sectionComments = {};
                const patientInfo = {
                    name: patientName.value,
                    birthDate: patientBirthDate.value,
                    id: patientId.value,
                    checkDate: checkDate.value
                };
                
                const checkboxes = form.querySelectorAll('input[type="checkbox"]');
                checkboxes.forEach(checkbox => {
                    data[checkbox.id] = checkbox.checked;
                    
                    const commentArea = document.getElementById('comment_' + checkbox.id);
                    if (commentArea) {
                        comments[checkbox.id] = commentArea.value;
                    }
                });
                
                const sectionCommentAreas = document.querySelectorAll('.section-comment-area');
                sectionCommentAreas.forEach(area => {
                    const sectionId = area.id.replace('section_comment_', '');
                    sectionComments[sectionId] = area.value;
                });
                
                localStorage.setItem('checklistData', JSON.stringify(data));
                localStorage.setItem('checklistComments', JSON.stringify(comments));
                localStorage.setItem('sectionComments', JSON.stringify(sectionComments));
                localStorage.setItem('patientInfo', JSON.stringify(patientInfo));
                showStatus('Данные сохранены', 'success');
            }
            
            function startAutoSave() {
                autoSaveInterval = setInterval(saveData, 10000);
            }
            
            function showStatus(message, type = 'info') {
                statusMessage.textContent = message;
                statusMessage.style.background = type === 'success' ? '#e8f5e8' : 
                                               type === 'error' ? '#fde8e8' : '#e8f4fd';
                statusMessage.style.borderColor = type === 'success' ? '#27ae60' : 
                                                type === 'error' ? '#e74c3c' : '#3498db';
                
                setTimeout(() => {
                    statusMessage.textContent = 'Готов к работе • Автосохранение каждые 10 секунд';
                    statusMessage.style.background = '#e8f4fd';
                    statusMessage.style.borderColor = '#3498db';
                }, 3000);
            }
            
            function clearForm() {
                if (confirm('Вы уверены, что хотите очистить всю форму?')) {
                    const checkboxes = form.querySelectorAll('input[type="checkbox"]');
                    checkboxes.forEach(checkbox => {
                        checkbox.checked = false;
                    });
                    
                    const commentAreas = form.querySelectorAll('.comment-area');
                    commentAreas.forEach(area => {
                        area.value = '';
                    });
                    
                    const sectionCommentAreas = document.querySelectorAll('.section-comment-area');
                    sectionCommentAreas.forEach(area => {
                        area.value = '';
                    });
                    
                    patientName.value = '';
                    patientBirthDate.value = '';
                    patientId.value = '';
                    setCurrentDate();
                    
                    localStorage.removeItem('checklistData');
                    localStorage.removeItem('checklistComments');
                    localStorage.removeItem('sectionComments');
                    localStorage.removeItem('patientInfo');
                    updateProgress();
                    showStatus('Форма очищена', 'success');
                }
            }
            
            function saveToExcel() {
                try {
                    const data = [];
                    
                    data.push(['Чек-лист проверки медицинской карты - BETA', '', '']);
                    data.push(['ФИО пациента:', '', patientName.value || 'Не указано']);
                    data.push(['Дата рождения:', '', patientBirthDate.value || 'Не указано']);
                    data.push(['ID/номер карты:', '', patientId.value || 'Не указано']);
                    data.push(['Дата проверки:', '', checkDate.value || new Date().toISOString().split('T')[0]]);
                    data.push(['', '', '']);
                    
                    data.push(['Раздел', 'Пункт', 'Описание', 'Статус', 'Комментарий']);
                    
                    const sections = form.querySelectorAll('.section');
                    
                    sections.forEach(section => {
                        const sectionTitle = section.querySelector('h2').textContent;
                        data.push([sectionTitle, '', '', '', '']);
                        
                        const questions = section.querySelectorAll('.question-block');
                        questions.forEach(question => {
                            const checkbox = question.querySelector('input[type="checkbox"]');
                            const label = question.querySelector('.question-label');
                            const commentArea = question.querySelector('.comment-area');
                            
                            const status = checkbox.checked ? 'ПРОВЕРЕНО' : 'НЕ ПРОВЕРЕНО';
                            const comment = commentArea ? commentArea.value : '';
                            
                            data.push(['', checkbox.id, label.textContent.trim(), status, comment]);
                        });
                        
                        const sectionId = Array.from(sections).indexOf(section) + 1;
                        const sectionCommentArea = document.getElementById('section_comment_' + sectionId);
                        if (sectionCommentArea && sectionCommentArea.value.trim()) {
                            data.push(['', '', 'Комментарий к разделу:', '', sectionCommentArea.value]);
                        }
                        
                        data.push(['', '', '', '', '']);
                    });
                    
                    const ws = XLSX.utils.aoa_to_sheet(data);
                    const wb = XLSX.utils.book_new();
                    
                    const colWidths = [
                        { wch: 25 },
                        { wch: 8 },
                        { wch: 60 },
                        { wch: 12 },
                        { wch: 40 }
                    ];
                    ws['!cols'] = colWidths;
                    
                    const range = XLSX.utils.decode_range(ws['!ref']);
                    for (let R = range.s.r; R <= range.e.r; ++R) {
                        for (let C = range.s.c; C <= range.e.c; ++C) {
                            const cell_address = {c: C, r: R};
                            const cell_ref = XLSX.utils.encode_cell(cell_address);
                            
                            if (ws[cell_ref]) {
                                if (!ws[cell_ref].s) ws[cell_ref].s = {};
                                ws[cell_ref].s.alignment = {
                                    horizontal: 'left',
                                    vertical: 'top',
                                    wrapText: true
                                };
                            }
                        }
                    }
                    
                    let fileName = 'чек-лист_медицинской_карты_BETA';
                    if (patientName.value) {
                        fileName += '_' + patientName.value.replace(/\s+/g, '_');
                    }
                    if (patientId.value) {
                        fileName += '_' + patientId.value;
                    }
                    fileName += '_' + (checkDate.value || new Date().toISOString().split('T')[0]) + '.xlsx';
                    
                    XLSX.utils.book_append_sheet(wb, ws, "Чек-лист");
                    XLSX.writeFile(wb, fileName);
                    showStatus('Файл Excel успешно сохранен!', 'success');
                    
                } catch (error) {
                    console.error('Ошибка при сохранении в Excel:', error);
                    showStatus('Ошибка при сохранении файла', 'error');
                }
            }
            
            function init() {
                setCurrentDate();
                initCounters();
                setupCommentAutoCheck();
                setupBlockClick();
                loadSavedData();
                startAutoSave();
                
                checkDate.addEventListener('change', function() {
                    if (this.value) {
                        const date = new Date(this.value);
                        currentDateDisplay.textContent = `Дата проверки: ${date.toLocaleDateString('ru-RU')}`;
                    }
                });
                
                clearBtn.addEventListener('click', clearForm);
                saveExcelBtn.addEventListener('click', saveToExcel);
                form.addEventListener('change', updateProgress);
                
                [patientName, patientBirthDate, patientId, checkDate].forEach(field => {
                    field.addEventListener('input', saveData);
                });
                
                const sectionCommentAreas = document.querySelectorAll('.section-comment-area');
                sectionCommentAreas.forEach(area => {
                    area.addEventListener('input', saveData);
                });
            }
            
            init();
        });
    </script>
</body>
</html>
