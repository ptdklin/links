<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Калькулятор индекса коморбидности Чарлсона</title>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --light-color: #ecf0f1;
            --dark-color: #34495e;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background-color: var(--primary-color);
            color: white;
            padding: 20px 0;
            text-align: center;
            border-radius: 8px 8px 0 0;
            margin-bottom: 20px;
        }
        
        h1 {
            font-size: 1.8rem;
            margin-bottom: 10px;
        }
        
        .description {
            font-size: 0.9rem;
            max-width: 800px;
            margin: 0 auto;
            opacity: 0.9;
        }
        
        .explanation {
            background-color: white;
            border-radius: 8px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border-left: 4px solid var(--secondary-color);
        }
        
        .explanation h2 {
            color: var(--primary-color);
            margin-bottom: 15px;
        }
        
        .explanation-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .explanation-section {
            margin-bottom: 15px;
        }
        
        .explanation-section h3 {
            color: var(--secondary-color);
            margin-bottom: 8px;
            font-size: 1.1rem;
        }
        
        .calculator-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .patient-info, .diseases-form {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .patient-info {
            flex: 1;
            min-width: 300px;
        }
        
        .diseases-form {
            flex: 2;
            min-width: 300px;
        }
        
        .results-container {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-top: 20px;
            display: none;
        }
        
        .results-container.active {
            display: block;
        }
        
        h2 {
            color: var(--primary-color);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }
        
        input[type="text"], input[type="date"], input[type="number"], select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }
        
        .disease-category {
            margin-bottom: 20px;
        }
        
        .category-title {
            background-color: var(--light-color);
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .disease-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            padding: 8px;
            border-radius: 4px;
            transition: background-color 0.2s;
        }
        
        .disease-item:hover {
            background-color: #f9f9f9;
        }
        
        .disease-item input {
            margin-right: 10px;
        }
        
        .disease-score {
            display: inline-block;
            background-color: var(--secondary-color);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            margin-left: auto;
        }
        
        .score-1 { background-color: #3498db; }
        .score-2 { background-color: #f39c12; }
        .score-3 { background-color: #e67e22; }
        .score-6 { background-color: #e74c3c; }
        
        .age-group {
            background-color: var(--light-color);
            padding: 15px;
            border-radius: 4px;
            margin-top: 20px;
        }
        
        .results-content {
            padding: 10px 0;
        }
        
        .result-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .result-value {
            font-weight: 600;
        }
        
        .risk-level {
            padding: 10px;
            border-radius: 4px;
            text-align: center;
            font-weight: 600;
            margin-top: 15px;
        }
        
        .risk-minimal { background-color: #2ecc71; color: white; }
        .risk-low { background-color: #3498db; color: white; }
        .risk-moderate { background-color: #f39c12; color: white; }
        .risk-high { background-color: #e74c3c; color: white; }
        
        .conclusions {
            margin-top: 25px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .brief-conclusion, .detailed-conclusion {
            padding: 15px;
            border-radius: 4px;
            background-color: #f8f9fa;
        }
        
        .brief-conclusion {
            border-left: 4px solid #27ae60;
        }
        
        .detailed-conclusion {
            border-left: 4px solid #3498db;
        }
        
        .conclusion h3 {
            margin-bottom: 10px;
            color: var(--primary-color);
        }
        
        .actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 12px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: background-color 0.3s;
            flex: 1;
            min-width: 150px;
        }
        
        .calculate-btn {
            background-color: var(--secondary-color);
            color: white;
        }
        
        .calculate-btn:hover {
            background-color: #2980b9;
        }
        
        .print-btn {
            background-color: var(--dark-color);
            color: white;
        }
        
        .print-btn:hover {
            background-color: #2c3e50;
        }
        
        .download-btn {
            background-color: #27ae60;
            color: white;
        }
        
        .download-btn:hover {
            background-color: #219653;
        }
        
        .interpretation {
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 4px;
            border-left: 4px solid var(--secondary-color);
        }
        
        .interpretation h3 {
            margin-bottom: 10px;
            color: var(--primary-color);
        }
        
        footer {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            color: #7f8c8d;
            font-size: 0.9rem;
        }
        
        @media print {
            .no-print {
                display: none;
            }
            
            .patient-info, .diseases-form, .results-container {
                box-shadow: none;
                border: 1px solid #ddd;
            }
            
            .actions {
                display: none;
            }
            
            .results-container {
                display: block !important;
            }
            
            .detailed-conclusion {
                display: none;
            }
        }
        
        @media (max-width: 768px) {
            .explanation-content, .conclusions {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Калькулятор индекса коморбидности Чарлсона</h1>
            <p class="description">Методика оценки сопутствующей патологии для стратификации риска и прогнозирования исходов</p>
        </header>
        
        <div class="explanation">
            <h2>Почему индекс коморбидности Чарлсона важен для фтизиатрии</h2>
            <div class="explanation-content">
                <div class="explanation-section">
                    <h3>Значение индекса в фтизиатрии</h3>
                    <p>Ведение пациентов с туберкулёзом всё чаще связано с необходимостью работы с лицами, имеющими широкий спектр хронических заболеваний: сердечно-сосудистую патологию, сахарный диабет, ХОБЛ, заболевания печени и почек, онкологические процессы и др. Наличие сопутствующих болезней влияет не только на прогноз выживаемости, но и на переносимость противотуберкулёзных препаратов, частоту лекарственных взаимодействий и риск нежелательных реакций.</p>
                    <p>В этих условиях индекс коморбидности Чарлсона становится важным инструментом клинического мышления врача-фтизиатра. Он позволяет перевести субъективное впечатление о тяжести фона в измеримый показатель, который можно использовать:</p>
                    <ul>
                        <li>при выборе схемы лечения;</li>
                        <li>в оценке риска осложнений;</li>
                        <li>при прогнозировании исхода заболевания;</li>
                        <li>при планировании наблюдения;</li>
                        <li>в коммуникации с пациентом и его семьёй.</li>
                    </ul>
                    <p>Таким образом индекс помогает перейти от общей формулировки «пациент тяжёлый» к объективизированной оценке клинического риска.</p>
                </div>
                
                <div class="explanation-section">
                    <h3>Что даёт использование индекса врачу-фтизиатру</h3>
                    <p>Индекс Чарлсона помогает:</p>
                    <ul>
                        <li>увидеть реальный физиологический резерв пациента и его способность переносить длительные этапы противотуберкулёзной терапии;</li>
                        <li>улучшить безопасность лечения за счёт более осознанного учёта лекарственных взаимодействий и токсичности препаратов;</li>
                        <li>повысить профессиональную уверенность при назначении схемы и аргументировании решений;</li>
                        <li>улучшить взаимодействие с пациентом и его близкими, формируя осознанную приверженность лечению;</li>
                        <li>соответствовать современным принципам клинического управления рисками и качеством медицинской помощи.</li>
                    </ul>
                    <p>Для врача-фтизиатра это переход от шаблонного назначения схемы к персонализированному ведению пациента, основанному на оценке риска, прогноза и потенциальной уязвимости организма к медикаментозной нагрузке.</p>
                </div>
                
                <div class="explanation-section">
                    <h3>Связь индекса с управлением лекарственной безопасностью</h3>
                    <p>Согласно Практическим рекомендациям по организации внутреннего контроля качества и безопасности медицинской деятельности в медицинской организации (поликлинике), одним из современных требований является вовлечение пациента и его окружения в обеспечение безопасности лекарственной терапии.</p>
                    <p>Индекс коморбидности Чарлсона позволяет:</p>
                    <ul>
                        <li>выделить пациентов, требующих более тщательного мониторинга;</li>
                        <li>заранее определить группы высокого риска развития нежелательных реакций;</li>
                        <li>формировать индивидуальные планы наблюдения и информирования;</li>
                        <li>аргументированно донести до пациента необходимость соблюдения режима лечения;</li>
                        <li>обеспечить раннюю профилактику осложнений, связанных с одновременным применением нескольких препаратов, и способствовать поддержанию рациональной фармакотерапии.</li>
                    </ul>
                    <p>Таким образом шкала становится не только инструментом оценки прогноза, но и основой безопасного лекарственного сопровождения пациента.</p>
                </div>
                
                <div class="explanation-section">
                    <h3>Интерпретация результата</h3>
                    <ul>
                        <li><strong>0 баллов</strong> — минимальный риск. Стандартный мониторинг, базовый учет лекарственных взаимодействий, информирование пациента о ключевых правилах приема препаратов.</li>
                        
                        <li><strong>1–2 балла</strong> — низкий риск. <strong>Обязательный систематический</strong> учет взаимодействий, регулярный лабораторный контроль, активное обучение пациента самоконтролю и соблюдению режима терапии.</li>
                        
                        <li><strong>3–4 балла</strong> — умеренный риск. <strong>Проактивный углубленный</strong> анализ взаимодействий ДО назначения схемы, адаптация терапии, усиленный мониторинг, партнерство с пациентом и семьей в контроле состояния и раннем выявлении побочных эффектов.</li>
                        
                        <li><strong>5 и более баллов</strong> — высокий риск. <strong>Исчерпывающий</strong> анализ всех назначений (возможно с привлечением клинического фармаколога), индивидуализированный план лечения, интенсивное наблюдение, создание системы поддержки с активным участием пациента и его окружения.</li>
                    </ul>
                </div>
                
                <div class="explanation-section">
                    <h3>Практические действия врача после расчёта индекса</h3>
                    <ul>
                        <li>Внести результат в медицинскую документацию.</li>
                        <li>Сформировать индивидуальную стратегию лечения с учётом риска осложнений.</li>
                        <li>Определить оптимальный объём и частоту мониторинга.</li>
                        <li>Организовать обучение пациента и его близких по признакам возможных осложнений и правилам безопасного приёма препаратов.</li>
                        <li>При необходимости — подключить специалистов смежных направлений.</li>
                        <li>Использовать данные индекса как основу для долгосрочного контроля эффективности и безопасности лечения.</li>
                    </ul>
                </div>
                
                <div class="explanation-section">
                    <h3>Заключение</h3>
                    <p>Индекс коморбидности Чарлсона — это практический инструмент, помогающий сделать лечение туберкулёза более безопасным, прогнозируемым и персонализированным. Его применение укрепляет клиническую уверенность врача, улучшает качество коммуникации с пациентом и способствует повышению общей безопасности медицинской помощи.</p>
                </div>
            </div>
        </div>
        
        <div class="calculator-container">
            <div class="patient-info">
                <h2>Паспортные данные</h2>
                <div class="form-group">
                    <label for="lastName">Фамилия</label>
                    <input type="text" id="lastName" placeholder="Введите фамилию">
                </div>
                <div class="form-group">
                    <label for="firstName">Имя</label>
                    <input type="text" id="firstName" placeholder="Введите имя">
                </div>
                <div class="form-group">
                    <label for="middleName">Отчество</label>
                    <input type="text" id="middleName" placeholder="Введите отчество">
                </div>
                <div class="form-group">
                    <label for="birthDate">Дата рождения</label>
                    <input type="date" id="birthDate">
                </div>
                <div class="form-group">
                    <label for="patientId">Идентификатор пациента</label>
                    <input type="text" id="patientId" placeholder="Номер истории болезни">
                </div>
                <div class="form-group">
                    <label for="examinationDate">Дата обследования</label>
                    <input type="date" id="examinationDate">
                </div>
            </div>
            
            <div class="diseases-form">
                <h2>Сопутствующие заболевания</h2>
                
                <div class="disease-category">
                    <div class="category-title">Заболевания с коэффициентом 1</div>
                    <div class="disease-list">
                        <div class="disease-item">
                            <input type="checkbox" id="disease1" data-score="1">
                            <label for="disease1">Инфаркт миокарда в анамнезе</label>
                            <span class="disease-score score-1">1 балл</span>
                        </div>
                        <div class="disease-item">
                            <input type="checkbox" id="disease2" data-score="1">
                            <label for="disease2">Хроническая сердечная недостаточность</label>
                            <span class="disease-score score-1">1 балл</span>
                        </div>
                        <div class="disease-item">
                            <input type="checkbox" id="disease3" data-score="1">
                            <label for="disease3">Облитерирующие заболевания периферических артерий</label>
                            <span class="disease-score score-1">1 балл</span>
                        </div>
                        <div class="disease-item">
                            <input type="checkbox" id="disease4" data-score="1">
                            <label for="disease4">Цереброваскулярная болезнь</label>
                            <span class="disease-score score-1">1 балл</span>
                        </div>
                        <div class="disease-item">
                            <input type="checkbox" id="disease5" data-score="1">
                            <label for="disease5">Деменция</label>
                            <span class="disease-score score-1">1 балл</span>
                        </div>
                        <div class="disease-item">
                            <input type="checkbox" id="disease6" data-score="1">
                            <label for="disease6">Хронические заболевания легких</label>
                            <span class="disease-score score-1">1 балл</span>
                        </div>
                        <div class="disease-item">
                            <input type="checkbox" id="disease7" data-score="1">
                            <label for="disease7">Заболевания соединительной ткани</label>
                            <span class="disease-score score-1">1 балл</span>
                        </div>
                        <div class="disease-item">
                            <input type="checkbox" id="disease8" data-score="1">
                            <label for="disease8">Язвенная болезнь желудка и двенадцатиперстной кишки</label>
                            <span class="disease-score score-1">1 балл</span>
                        </div>
                        <div class="disease-item">
                            <input type="checkbox" id="disease9" data-score="1">
                            <label for="disease9">Легкие заболевания печени (без портальной гипертензии)</label>
                            <span class="disease-score score-1">1 балл</span>
                        </div>
                        <div class="disease-item">
                            <input type="checkbox" id="disease10" data-score="1">
                            <label for="disease10">Сахарный диабет без осложнений</label>
                            <span class="disease-score score-1">1 балл</span>
                        </div>
                    </div>
                </div>
                
                <div class="disease-category">
                    <div class="category-title">Заболевания с коэффициентом 2</div>
                    <div class="disease-list">
                        <div class="disease-item">
                            <input type="checkbox" id="disease11" data-score="2">
                            <label for="disease11">Гемиплегия</label>
                            <span class="disease-score score-2">2 балла</span>
                        </div>
                        <div class="disease-item">
                            <input type="checkbox" id="disease12" data-score="2">
                            <label for="disease12">Умеренные и тяжелые заболевания почек (СКФ <50 мл/мин)</label>
                            <span class="disease-score score-2">2 балла</span>
                        </div>
                        <div class="disease-item">
                            <input type="checkbox" id="disease13" data-score="2">
                            <label for="disease13">Сахарный диабет с органными осложнениями</label>
                            <span class="disease-score score-2">2 балла</span>
                        </div>
                        <div class="disease-item">
                            <input type="checkbox" id="disease14" data-score="2">
                            <label for="disease14">Злокачественные новообразования без метастазов</label>
                            <span class="disease-score score-2">2 балла</span>
                        </div>
                        <div class="disease-item">
                            <input type="checkbox" id="disease15" data-score="2">
                            <label for="disease15">Лейкемии</label>
                            <span class="disease-score score-2">2 балла</span>
                        </div>
                        <div class="disease-item">
                            <input type="checkbox" id="disease16" data-score="2">
                            <label for="disease16">Лимфомы</label>
                            <span class="disease-score score-2">2 балла</span>
                        </div>
                    </div>
                </div>
                
                <div class="disease-category">
                    <div class="category-title">Заболевания с коэффициентом 3</div>
                    <div class="disease-list">
                        <div class="disease-item">
                            <input type="checkbox" id="disease17" data-score="3">
                            <label for="disease17">Умеренные и тяжелые заболевания печени (с портальной гипертензией)</label>
                            <span class="disease-score score-3">3 балла</span>
                        </div>
                    </div>
                </div>
                
                <div class="disease-category">
                    <div class="category-title">Заболевания с коэффициентом 6</div>
                    <div class="disease-list">
                        <div class="disease-item">
                            <input type="checkbox" id="disease18" data-score="6">
                            <label for="disease18">Злокачественные новообразования с метастазами</label>
                            <span class="disease-score score-6">6 баллов</span>
                        </div>
                        <div class="disease-item">
                            <input type="checkbox" id="disease19" data-score="6">
                            <label for="disease19">СПИД</label>
                            <span class="disease-score score-6">6 баллов</span>
                        </div>
                    </div>
                </div>
                
                <div class="age-group">
                    <h3>Возрастной коэффициент</h3>
                    <div class="form-group">
                        <label for="age">Возраст пациента (лет)</label>
                        <input type="number" id="age" min="0" max="120" placeholder="Введите возраст">
                    </div>
                </div>
            </div>
        </div>
        
        <div class="actions no-print">
            <button class="calculate-btn" id="calculateBtn">Рассчитать индекс коморбидности</button>
            <button class="print-btn" id="printBtn">Печать результатов</button>
            <button class="download-btn" id="downloadBtn">Скачать в Excel</button>
        </div>
        
        <div class="results-container" id="resultsContainer">
            <h2>Результаты расчета индекса коморбидности Чарлсона</h2>
            <div class="results-content">
                <div class="result-item">
                    <span>Сумма баллов по заболеваниям:</span>
                    <span class="result-value" id="diseaseScore">0</span>
                </div>
                <div class="result-item">
                    <span>Возрастной коэффициент:</span>
                    <span class="result-value" id="ageScore">0</span>
                </div>
                <div class="result-item">
                    <span>Общий индекс коморбидности:</span>
                    <span class="result-value" id="totalScore">0</span>
                </div>
                <div class="result-item">
                    <span>10-летняя выживаемость:</span>
                    <span class="result-value" id="survivalRate">-</span>
                </div>
            </div>
            
            <div id="riskLevel" class="risk-level">Уровень риска не определен</div>
            
            <div class="conclusions">
                <div class="brief-conclusion">
                    <h3>Краткие выводы (для печати)</h3>
                    <p id="briefConclusionText">Проведите расчет для получения выводов</p>
                </div>
                
                <div class="detailed-conclusion">
                    <h3>Развернутая клиническая оценка</h3>
                    <div id="detailedConclusionText">
                        <p>После проведения расчета здесь будет представлена детальная клиническая интерпретация результатов индекса коморбидности Чарлсона с учетом индивидуальных особенностей пациента и рекомендациями для дальнейшего ведения.</p>
                    </div>
                </div>
            </div>
            
            <div class="interpretation">
                <h3>Интерпретация результатов индекса коморбидности Чарлсона</h3>
                <p>Индекс коморбидности Чарлсона коррелирует с 10-летней выживаемостью:</p>
                <ul>
                    <li><strong>0 баллов:</strong> 98% выживаемость (минимальный риск) - пациент с минимальным риском осложнений, благоприятный прогноз</li>
                    <li><strong>1-2 балла:</strong> 90-96% выживаемость (низкий риск) - умеренная коморбидность, требует стандартного наблюдения</li>
                    <li><strong>3-4 балла:</strong> 77-87% выживаемость (умеренный риск) - значительная коморбидность, необходимо усиленное наблюдение</li>
                    <li><strong>≥5 баллов:</strong> ≤53% выживаемость (высокий риск) - тяжелая коморбидность, требуется комплексный мультидисциплинарный подход</li>
                </ul>
                <p><strong>Клиническое значение:</strong> В клинической практике особое значение имеет правильная интерпретация результатов с учетом индивидуальных особенностей пациента. Дальнейшее совершенствование методики связано с разработкой специализированных модификаций для конкретных групп больных.</p>
            </div>
        </div>
        
        <footer>
            <p>Индекс коморбидности Чарлсона остается "золотым стандартом" оценки сопутствующей патологии.</p>
            <p>Для повышения точности оценки рекомендуется комбинировать индекс с другими клиническими и лабораторными показателями.</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Установка текущей даты в поле даты обследования
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('examinationDate').value = today;
            
            // Расчет возраста при изменении даты рождения
            document.getElementById('birthDate').addEventListener('change', function() {
                const birthDate = new Date(this.value);
                const today = new Date();
                let age = today.getFullYear() - birthDate.getFullYear();
                const monthDiff = today.getMonth() - birthDate.getMonth();
                
                if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                    age--;
                }
                
                document.getElementById('age').value = age;
            });
            
            // Расчет индекса коморбидности
            document.getElementById('calculateBtn').addEventListener('click', calculateIndex);
            
            // Печать результатов
            document.getElementById('printBtn').addEventListener('click', function() {
                window.print();
            });
            
            // Скачивание в Excel
            document.getElementById('downloadBtn').addEventListener('click', downloadExcel);
            
            function calculateIndex() {
                let diseaseScore = 0;
                const selectedDiseases = [];
                
                // Суммируем баллы по выбранным заболеваниям
                const checkboxes = document.querySelectorAll('input[type="checkbox"]');
                checkboxes.forEach(checkbox => {
                    if (checkbox.checked) {
                        const score = parseInt(checkbox.getAttribute('data-score'));
                        diseaseScore += score;
                        selectedDiseases.push({
                            name: checkbox.nextElementSibling.textContent,
                            score: score
                        });
                    }
                });
                
                // Рассчитываем возрастной коэффициент
                const age = parseInt(document.getElementById('age').value) || 0;
                let ageScore = 0;
                
                if (age >= 40 && age <= 49) ageScore = 1;
                else if (age >= 50 && age <= 59) ageScore = 2;
                else if (age >= 60 && age <= 69) ageScore = 3;
                else if (age >= 70) ageScore = 4;
                
                // Общий индекс
                const totalScore = diseaseScore + ageScore;
                
                // Определяем уровень риска и выживаемость
                let survivalRate = '-';
                let riskLevel = '';
                let riskClass = '';
                let briefConclusion = '';
                let detailedConclusion = '';
                
                if (totalScore === 0) {
                    survivalRate = '98%';
                    riskLevel = 'Минимальный риск';
                    riskClass = 'risk-minimal';
                    briefConclusion = 'Пациент с минимальным риском осложнений. Благоприятный прогноз. Стандартное наблюдение.';
                    detailedConclusion = generateDetailedConclusion(totalScore, selectedDiseases, age, 'минимальным');
                } else if (totalScore >= 1 && totalScore <= 2) {
                    survivalRate = '90-96%';
                    riskLevel = 'Низкий риск';
                    riskClass = 'risk-low';
                    briefConclusion = 'Пациент с низким риском осложнений. Умеренная коморбидность. Стандартное наблюдение.';
                    detailedConclusion = generateDetailedConclusion(totalScore, selectedDiseases, age, 'низким');
                } else if (totalScore >= 3 && totalScore <= 4) {
                    survivalRate = '77-87%';
                    riskLevel = 'Умеренный риск';
                    riskClass = 'risk-moderate';
                    briefConclusion = 'Пациент с умеренным риском осложнений. Значительная коморбидность. Усиленное наблюдение.';
                    detailedConclusion = generateDetailedConclusion(totalScore, selectedDiseases, age, 'умеренным');
                } else if (totalScore >= 5) {
                    survivalRate = '≤53%';
                    riskLevel = 'Высокий риск';
                    riskClass = 'risk-high';
                    briefConclusion = 'Пациент с высоким риском осложнений. Тяжелая коморбидность. Интенсивное наблюдение.';
                    detailedConclusion = generateDetailedConclusion(totalScore, selectedDiseases, age, 'высоким');
                }
                
                // Обновляем результаты на странице
                document.getElementById('diseaseScore').textContent = diseaseScore;
                document.getElementById('ageScore').textContent = ageScore;
                document.getElementById('totalScore').textContent = totalScore;
                document.getElementById('survivalRate').textContent = survivalRate;
                
                const riskElement = document.getElementById('riskLevel');
                riskElement.textContent = riskLevel;
                riskElement.className = 'risk-level ' + riskClass;
                
                document.getElementById('briefConclusionText').textContent = briefConclusion;
                document.getElementById('detailedConclusionText').innerHTML = detailedConclusion;
                
                // Показываем блок с результатами
                document.getElementById('resultsContainer').classList.add('active');
                
                // Прокручиваем страницу к результатам
                document.getElementById('resultsContainer').scrollIntoView({ behavior: 'smooth' });
            }
            
            function generateDetailedConclusion(totalScore, diseases, age, riskLevel) {
                let conclusion = `<p>На основании расчета индекса коморбидности Чарлсона у пациента выявлен <strong>${riskLevel} риск</strong> осложнений (${totalScore} баллов).</p>`;
                
                conclusion += `<p>Возраст пациента: ${age} лет (${getAgeCategory(age)}).</p>`;
                
                if (diseases.length > 0) {
                    conclusion += '<p>У пациента выявлены следующие значимые сопутствующие заболевания:</p><ul>';
                    diseases.forEach(disease => {
                        conclusion += `<li>${disease.name} (${disease.score} балл${disease.score > 1 ? 'а' : ''})</li>`;
                    });
                    conclusion += '</ul>';
                } else {
                    conclusion += '<p>Значимые сопутствующие заболевания не выявлены.</p>';
                }
                
                conclusion += '<p><strong>Рекомендации по ведению пациента:</strong></p><ul>';
                
                if (totalScore === 0) {
                    conclusion += '<li>Стандартное диспансерное наблюдение согласно возрастной группе</li>';
                    conclusion += '<li>Профилактические мероприятия по поддержанию здоровья</li>';
                    conclusion += '<li>Регулярный скрининг основных заболеваний</li>';
                } else if (totalScore >= 1 && totalScore <= 2) {
                    conclusion += '<li>Регулярное наблюдение у терапевта 1 раз в 6 месяцев</li>';
                    conclusion += '<li>Контроль факторов риска прогрессирования выявленных заболеваний</li>';
                    conclusion += '<li>Индивидуализированный план профилактических мероприятий</li>';
                } else if (totalScore >= 3 && totalScore <= 4) {
                    conclusion += '<li>Усиленное наблюдение у терапевта 1 раз в 3 месяца</li>';
                    conclusion += '<li>Консультации узких специалистов по профилю выявленных заболеваний</li>';
                    conclusion += '<li>Разработка комплексного плана лечения с учетом взаимодействия заболеваний</li>';
                    conclusion += '<li>Регулярный мониторинг функционального состояния органов и систем</li>';
                } else if (totalScore >= 5) {
                    conclusion += '<li>Интенсивное мультидисциплинарное наблюдение</li>';
                    conclusion += '<li>Частое мониторирование клинического состояния (не реже 1 раза в месяц)</li>';
                    conclusion += '<li>Приоритизация лечения с учетом потенциальной пользы и рисков</li>';
                    conclusion += '<li>Рассмотрение паллиативного подхода при необходимости</li>';
                    conclusion += '<li>Психологическая поддержка пациента и членов семьи</li>';
                }
                
                conclusion += '</ul>';
                conclusion += '<p>Индекс коморбидности следует интерпретировать в комплексе с другими клиническими, лабораторными и инструментальными данными.</p>';
                
                return conclusion;
            }
            
            function getAgeCategory(age) {
                if (age < 40) return 'моложе 40 лет';
                if (age >= 40 && age <= 49) return '40-49 лет';
                if (age >= 50 && age <= 59) return '50-59 лет';
                if (age >= 60 && age <= 69) return '60-69 лет';
                return '70 лет и старше';
            }
            
            function downloadExcel() {
                // Собираем данные для Excel
                const patientData = {
                    lastName: document.getElementById('lastName').value || 'Не указано',
                    firstName: document.getElementById('firstName').value || 'Не указано',
                    middleName: document.getElementById('middleName').value || 'Не указано',
                    birthDate: document.getElementById('birthDate').value || 'Не указано',
                    patientId: document.getElementById('patientId').value || 'Не указано',
                    examinationDate: document.getElementById('examinationDate').value || 'Не указано',
                    age: document.getElementById('age').value || 'Не указано',
                    diseaseScore: document.getElementById('diseaseScore').textContent,
                    ageScore: document.getElementById('ageScore').textContent,
                    totalScore: document.getElementById('totalScore').textContent,
                    survivalRate: document.getElementById('survivalRate').textContent,
                    riskLevel: document.getElementById('riskLevel').textContent,
                    briefConclusion: document.getElementById('briefConclusionText').textContent
                };
                
                // Создаем CSV-строку
                let csvContent = "Индекс коморбидности Чарлсона\n\n";
                csvContent += "Паспортные данные:\n";
                csvContent += `Фамилия: ${patientData.lastName}\n`;
                csvContent += `Имя: ${patientData.firstName}\n`;
                csvContent += `Отчество: ${patientData.middleName}\n`;
                csvContent += `Дата рождения: ${patientData.birthDate}\n`;
                csvContent += `Идентификатор пациента: ${patientData.patientId}\n`;
                csvContent += `Дата обследования: ${patientData.examinationDate}\n`;
                csvContent += `Возраст: ${patientData.age}\n\n`;
                
                csvContent += "Результаты расчета:\n";
                csvContent += `Сумма баллов по заболеваниям: ${patientData.diseaseScore}\n`;
                csvContent += `Возрастной коэффициент: ${patientData.ageScore}\n`;
                csvContent += `Общий индекс коморбидности: ${patientData.totalScore}\n`;
                csvContent += `10-летняя выживаемость: ${patientData.survivalRate}\n`;
                csvContent += `Уровень риска: ${patientData.riskLevel}\n`;
                csvContent += `Краткие выводы: ${patientData.briefConclusion}\n\n`;
                
                // Собираем выбранные заболевания
                csvContent += "Выбранные заболевания:\n";
                const checkboxes = document.querySelectorAll('input[type="checkbox"]');
                checkboxes.forEach(checkbox => {
                    if (checkbox.checked) {
                        const label = checkbox.nextElementSibling.textContent;
                        const score = checkbox.getAttribute('data-score');
                        csvContent += `${label} (${score} балл${score > 1 ? 'а' : ''})\n`;
                    }
                });
                
                // Создаем и скачиваем файл
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement("a");
                const url = URL.createObjectURL(blob);
                link.setAttribute("href", url);
                link.setAttribute("download", `Индекс_коморбидности_${patientData.lastName}_${patientData.firstName}.csv`);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        });
    </script>
</body>
</html>
